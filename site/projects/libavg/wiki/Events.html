<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">

<!-- Mirrored from www.libavg.de/site/projects/libavg/wiki/Events by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 11 Jan 2025 18:11:12 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<title>Events - libavg</title>
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<meta name="csrf-param" content="authenticity_token"/>
<meta name="csrf-token" content="QVLF6cREvlOFkeaPHt4RhwQPDtrjsY3s5ITeOtTQ66Y="/>
<link rel='shortcut icon' href='../../../favicon89c0.ico?1332147363' />
<link href="../../../themes/libavg/stylesheets/applicationb1b8.css?1342212749" media="all" rel="stylesheet" type="text/css" />

<script src="../../../javascripts/prototype89c0.js?1332147363" type="text/javascript"></script>
<script src="../../../javascripts/effects89c0.js?1332147363" type="text/javascript"></script>
<script src="../../../javascripts/dragdrop89c0.js?1332147363" type="text/javascript"></script>
<script src="../../../javascripts/controls89c0.js?1332147363" type="text/javascript"></script>
<script src="../../../javascripts/application89c0.js?1332147363" type="text/javascript"></script>
<script type="text/javascript">
//<![CDATA[
Event.observe(window, 'load', function(){ new WarnLeavingUnsaved('The current page contains unsaved text that will be lost if you leave this page.'); });
//]]>
</script>



  
  

  <link href="../../../plugin_assets/redmine_wiki_extensions/stylesheets/wiki_extensions.css" media="screen" rel="stylesheet" type="text/css" />
  <script src="../../../plugin_assets/redmine_wiki_extensions/javascripts/wiki_extensions.js" type="text/javascript"></script>
  
    <script src="../../../plugin_assets/redmine_wiki_extensions/javascripts/tablesort.js" type="text/javascript"></script>
    <script type="text/javascript">
      //TableSort.arrowNone = " ";
      TableSort.arrowUp   = ' <img alt="Sort_asc" src="../../../images/sort_asc89c0.png?1332147363" />';
      TableSort.arrowDown = ' <img alt="Sort_desc" src="../../../images/sort_desc89c0.png?1332147363" />';
    </script>
  


<!-- page specific tags -->

  <link href="../../../stylesheets/scm89c0.css?1332147363" media="screen" rel="stylesheet" type="text/css" />
</head>
<body class="theme-Libavg controller-wiki action-show">
<div id="wrapper">
<div id="wrapper2">

<div id="header">
    

    

    <h1> <a href="../wiki.html"> <img src="../../../files/libavg_logo.png"/> </a> </h1>

    

    
</div>

<div class="" id="main">
    <div id="sidebar">
        
    <p><a href="WikiStart.html" class="wiki-page">Home</a><br /><a href="../../../../blog/" class="external">Blog</a><br /><a href="DownLoad.html" class="wiki-page">Download</a><br /><a href="FeatureList.html" class="wiki-page">Features</a><br /><a href="Multitouch.html" class="wiki-page">Multitouch</a><br /><a href="Showcase.html" class="wiki-page">Showcase</a></p>


	<a name="Documentation"></a>
<h2 >Documentation<a href="#Documentation" class="wiki-anchor">&para;</a></h2>


	<ul>
	<li><a href="ReleaseInstall.html" class="wiki-page">Installation Guide</a></li>
		<li><a href="ProgrammersGuide.html" class="wiki-page">Programmer's Guide</a></li>
		<li><a href="Firebirds.html" class="wiki-page">Tutorial</a></li>
		<li><a href="Reference.html" class="wiki-page">Reference</a></li>
	</ul>


	<a name="Community"></a>
<h2 >Community<a href="#Community" class="wiki-anchor">&para;</a></h2>


	<ul>
	<li><a href="BugReport.html" class="wiki-page">Reporting Bugs</a></li>
		<li><a href="Contributors.html" class="wiki-page">Contributors</a></li>
	</ul>


	<p><a href="Development.html" class="wiki-page">libavg Development</a></p>


	<p><a href="Imprint_and_Privacy_Policy.html" class="wiki-page">Imprint and Privacy Policy</a></p>
<p>
<br />
<a href="https://github.com/libavg/libavg/">Repository</a> <br />
<a href="https://github.com/libavg/libavg/issues?state=open">Issues</a> <br />
<a href="https://github.com/libavg/libavg/issues/new">New Issue</a><br />
</p>



        
    </div>

    <div id="content">
        
        





<div class="wiki wiki-page">
  <a name="Events"></a>
<h1 >Events<a href="#Events" class="wiki-anchor">&para;</a></h1>


	<ul class="toc right"><li><a href="#Events">Events</a></li><li><a href="#Example">Example</a></li><li><a href="#General-Mechanism">General Mechanism</a></li><li><a href="#Timers">Timers</a></li><li><a href="#More-on-the-Invoked-Functions">More on the Invoked Functions</a></li><li><a href="#Creating-Publishers-in-Python">Creating Publishers in Python</a></li></ul>


	<p>Besides building and modifying the scene graph, python scripts can react when a user interacts with the system, some time has elapsed or any other input has arrived. More specifically, apps can tell libavg objects - so-called Publishers - that they would like to be notified in the case of an event. This is called subscribing; the notification takes the form of a function call from libavg to the app.</p>


	<a name="Example"></a>
<h1 >Example<a href="#Example" class="wiki-anchor">&para;</a></h1>


	<p>Here's an example of reacting to a mouse press:</p>


	<p><em>ondown.py</em>:<br /><pre><code class="python syntaxhl"><span class="CodeRay"><span class="line-numbers"> 1</span><span class="comment">#!/usr/bin/env python</span>
<span class="line-numbers"> 2</span><span class="comment"># -*- coding: utf-8 -*-</span>
<span class="line-numbers"> 3</span>
<span class="line-numbers"> 4</span><span class="keyword">from</span> <span class="include">libavg</span> <span class="keyword">import</span> <span class="include">app</span>, <span class="include">avg</span>
<span class="line-numbers"> 5</span>
<span class="line-numbers"> 6</span><span class="keyword">class</span> <span class="class">MainDiv</span>(app.MainDiv):
<span class="line-numbers"> 7</span>    <span class="keyword">def</span> <span class="function">onInit</span>(<span class="predefined-constant">self</span>):
<span class="line-numbers"> 8</span>        <span class="predefined-constant">self</span>.toggleTouchVisualization()
<span class="line-numbers"> 9</span>        <span class="predefined-constant">self</span>.node = avg.WordsNode(pos=(<span class="integer">10</span>,<span class="integer">10</span>), text=<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>, parent=<span class="predefined-constant">self</span>)
<span class="line-numbers"><strong>10</strong></span>        <span class="predefined-constant">self</span>.node.subscribe(avg.Node.CURSOR_DOWN, <span class="predefined-constant">self</span>.onDown)
<span class="line-numbers">11</span>
<span class="line-numbers">12</span>    <span class="keyword">def</span> <span class="function">onDown</span>(<span class="predefined-constant">self</span>, event):
<span class="line-numbers">13</span>        <span class="predefined-constant">self</span>.node.x = <span class="integer">200</span>
<span class="line-numbers">14</span>
<span class="line-numbers">15</span>app.App().run(MainDiv())
</span></code></pre></p>


	<p>The app displays a "Hello World" text that is moved to a new position when the mouse button is pressed over the item. In this case, the <code>WordsNode</code> is the <code>Publisher</code>. The app registers for the event using <code>node.subscribe()</code>, and when the click happens, <code>MainDiv.onDown</code> is called by libavg.</p>


	<a name="General-Mechanism"></a>
<h1 >General Mechanism<a href="#General-Mechanism" class="wiki-anchor">&para;</a></h1>


	<p>The simple example above illustrates the general mechanism: To register for an event, call <code>Publisher.subscribe()</code> with the MessageID (in the example, <code>Node.CURSOR_DOWN</code>) and a Python callable (in the example, <code>self.onClick</code>) as parameters. Events you can subscribe to include all user input (e.g., key presses, mouse clicks and movements, touches on a touchscreen,...), but the principle is much broader: This is libavg's general notification mechanism. There are events that are triggered on each frame (<code>player.ON_FRAME</code>), when the end of a media file has been reached (<code>player.END_OF_FILE</code>), etc.. Any number of clients can subscribe to a message, and all of them will be invoked when the event occurs. In most cases, you donâ€™t have to deregister messages to clean up either. Subscriptions are based on weak references wherever possible, so when the object they refer to disappears, the subscription will just disappear as well. In cases where you would like to explicitly stop receiving a certain event, call <code>Publisher.unsubscribe()</code>.</p>


	<p>Like most user interface libraries, libavg is based on an event-driven programming model. This means that the flow of the program is determined by external events such as user actions or timers. Internally, libavg runs a main loop that looks approximately like this:</p>


<pre><code class="python syntaxhl"><span class="CodeRay"><span class="line-numbers">1</span><span class="keyword">while</span> <span class="keyword">not</span>(stopping):
<span class="line-numbers">2</span>    handleTimers()
<span class="line-numbers">3</span>    handleEvents()
<span class="line-numbers">4</span>    render()
</span></code></pre>

	<p>All python code is executed in <code>handleTimers()</code> and <code>handleEvents()</code>. As a consequence, the display is only updated after the python code returns, when <code>render()</code> runs. It also means that an event handler that takes a significant amout of time (such as waiting for network transmission) will cause screen updates to hang during this time.</p>


	<a name="Timers"></a>
<h1 >Timers<a href="#Timers" class="wiki-anchor">&para;</a></h1>


	<p>Timers that fire after a set interval are an exception to the 'all notifications use a publish-subscribe mechanism' principle declared above: There is a separate <code>Player.setTimeout()</code> method that handles this event type.</p>


	<p>As an example, consider moving a node after one second of playback:</p>


	<p><em>timer.py</em>:<br /><pre><code class="python syntaxhl"><span class="CodeRay"><span class="line-numbers"> 1</span><span class="comment">#!/usr/bin/env python</span>
<span class="line-numbers"> 2</span><span class="comment"># -*- coding: utf-8 -*-</span>
<span class="line-numbers"> 3</span>
<span class="line-numbers"> 4</span><span class="keyword">from</span> <span class="include">libavg</span> <span class="keyword">import</span> <span class="include">avg</span>, <span class="include">player</span>
<span class="line-numbers"> 5</span>
<span class="line-numbers"> 6</span><span class="keyword">class</span> <span class="class">MainDiv</span>(app.MainDiv):
<span class="line-numbers"> 7</span>    <span class="keyword">def</span> <span class="function">onInit</span>(<span class="predefined-constant">self</span>):
<span class="line-numbers"> 8</span>        <span class="predefined-constant">self</span>.toggleTouchVisualization()
<span class="line-numbers"> 9</span>        <span class="predefined-constant">self</span>.node = avg.WordsNode(pos=(<span class="integer">10</span>,<span class="integer">10</span>), text=<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>, parent=<span class="predefined-constant">self</span>)
<span class="line-numbers"><strong>10</strong></span>
<span class="line-numbers">11</span>        player.setTimeout(<span class="integer">1000</span>, moveText)
<span class="line-numbers">12</span>
<span class="line-numbers">13</span>    <span class="keyword">def</span> <span class="function">moveText</span>(<span class="predefined-constant">self</span>):
<span class="line-numbers">14</span>        <span class="predefined-constant">self</span>.node.x = <span class="integer">200</span>
<span class="line-numbers">15</span>
<span class="line-numbers">16</span>app.App().run(MainDiv())
</span></code></pre></p>


	<p>The <code>setTimeout()</code> call is what makes this happen. It tells libavg to call the routine specified (in this case, <code>moveText()</code>) after a certain time has elapsed (in this case, 1000 milliseconds). In addition to <code>setTimeout()</code>, there is a <code>setInterval()</code> method that lets you register a routine to call regularly.</p>


	<p>For more info on timing, have a look at <a href="Timing.html" class="wiki-page">Timing</a>.</p>


	<a name="More-on-the-Invoked-Functions"></a>
<h1 >More on the Invoked Functions<a href="#More-on-the-Invoked-Functions" class="wiki-anchor">&para;</a></h1>


	<p>Any Python callable can be registered as a callback, including standalone functions, class methods, lambdas and even class constructors. For simple callbacks - standalone functions or class methods -, this simply means passing the function name without parentheses to <code>subscribe()</code>:</p>


<pre><code class="python syntaxhl"><span class="CodeRay"><span class="line-numbers">1</span>node.subscribe(avg.Node.CURSOR_DOWN, <span class="predefined-constant">self</span>.onDown)
</span></code></pre>

	<p>In this case, onDown is called with an additional parameter, <code>event</code>, so you need to declare it as follows:</p>


<pre><code class="python syntaxhl"><span class="CodeRay"><span class="line-numbers">1</span><span class="keyword">def</span> <span class="function">onDown</span>(<span class="predefined-constant">self</span>, event):
</span></code></pre>

	<p>In some cases however, it becomes necessary to pass additional parameters to the callback when subscribe is called. To do this, you can use <code>lambdas</code>. An in-depth explanation of how <code>lambda</code> works is out of scope for this article (<a class="external" href="http://www.diveintopython.net/power_of_introspection/lambda_functions.html">http://www.diveintopython.net/power_of_introspection/lambda_functions.html</a> has a good explanation), but as an example for the power of this construct, have a look at this extremely compact number pad implementation that creates ten buttons which act differently:</p>


	<p><em>numberpad.py</em>:<br /><pre><code class="python syntaxhl"><span class="CodeRay"><span class="line-numbers"> 1</span><span class="comment">#!/usr/bin/env python</span>
<span class="line-numbers"> 2</span><span class="comment"># -*- coding: utf-8 -*-</span>
<span class="line-numbers"> 3</span>
<span class="line-numbers"> 4</span><span class="keyword">from</span> <span class="include">libavg</span> <span class="keyword">import</span> <span class="include">app</span>, <span class="include">avg</span>, <span class="include">widget</span>
<span class="line-numbers"> 5</span>
<span class="line-numbers"> 6</span><span class="keyword">class</span> <span class="class">MainDiv</span>(app.MainDiv):
<span class="line-numbers"> 7</span>    <span class="keyword">def</span> <span class="function">onInit</span>(<span class="predefined-constant">self</span>):
<span class="line-numbers"> 8</span>        <span class="predefined-constant">self</span>.toggleTouchVisualization()
<span class="line-numbers"> 9</span>        <span class="predefined-constant">self</span>.textNode = avg.WordsNode(pos=(<span class="integer">10</span>,<span class="integer">10</span>), text=<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>, parent=<span class="predefined-constant">self</span>) 
<span class="line-numbers"><strong>10</strong></span>        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="predefined">range</span>(<span class="integer">0</span>,<span class="integer">10</span>):
<span class="line-numbers">11</span>            pos = avg.Point2D(<span class="integer">10</span>,<span class="integer">40</span>) + ((i%<span class="integer">3</span>)*<span class="integer">40</span>, (i//<span class="integer">3</span>)*<span class="integer">40</span>)
<span class="line-numbers">12</span>            node = widget.TextButton(pos=pos, size=(<span class="integer">30</span>,<span class="integer">30</span>), text=<span class="predefined">str</span>(i), parent=<span class="predefined-constant">self</span>)
<span class="line-numbers">13</span>            node.subscribe(widget.Button.CLICKED, <span class="keyword">lambda</span> i=i: <span class="predefined-constant">self</span>.onDown(i))
<span class="line-numbers">14</span>
<span class="line-numbers">15</span>    <span class="keyword">def</span> <span class="function">onDown</span>(<span class="predefined-constant">self</span>, i):
<span class="line-numbers">16</span>        <span class="predefined-constant">self</span>.textNode.text += <span class="predefined">str</span>(i)
<span class="line-numbers">17</span>
<span class="line-numbers">18</span>app.App().run(MainDiv())
</span></code></pre></p>


	<a name="Creating-Publishers-in-Python"></a>
<h1 >Creating Publishers in Python<a href="#Creating-Publishers-in-Python" class="wiki-anchor">&para;</a></h1>


	<p>You can write your own publishers in Python by simply deriving from the Publisher class (Nodes are derived from Publisher already). You need just two lines of code to register a message:</p>


<pre><code class="python syntaxhl"><span class="CodeRay"><span class="line-numbers">1</span><span class="keyword">class</span> <span class="class">Button</span>(avg.DivNode):
<span class="line-numbers">2</span>    CLICKED = avg.Publisher.genMessageID()
<span class="line-numbers">3</span>    [...]
<span class="line-numbers">4</span>    <span class="keyword">def</span> <span class="function">__init__</span>(...):
<span class="line-numbers">5</span>        <span class="predefined-constant">self</span>.publish(<span class="predefined-constant">self</span>.CLICKED)
<span class="line-numbers">6</span>    [...]
</span></code></pre>

	<p>and this line invokes all registered subscribers:</p>


<pre><code class="python syntaxhl"><span class="CodeRay"><span class="line-numbers">1</span><span class="predefined-constant">self</span>.notifySubscribers(<span class="predefined-constant">self</span>.CLICKED, [])
</span></code></pre>

	<p>The second parameter to <code>notifySubscribers</code> is a list of parameters to pass to the subscribers. For example code, have a look at the widget classes under <code>src/python/widget</code>.</p>


	<p></p>
</div>














        
        <div style="clear:both;"></div>
    </div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>


</div>
</div>
<script type="text/javascript">
//<![CDATA[
wiki_extension_create_table_header();
//]]>
</script>
</body>

<!-- Mirrored from www.libavg.de/site/projects/libavg/wiki/Events by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 11 Jan 2025 18:11:12 GMT -->
</html>
