<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">

<!-- Mirrored from www.libavg.de/site/projects/libavg/wiki/Firebirds by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 11 Jan 2025 17:19:57 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<title>Firebirds - libavg</title>
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<meta name="csrf-param" content="authenticity_token"/>
<meta name="csrf-token" content="QVLF6cREvlOFkeaPHt4RhwQPDtrjsY3s5ITeOtTQ66Y="/>
<link rel='shortcut icon' href='../../../favicon89c0.ico?1332147363' />
<link href="../../../themes/libavg/stylesheets/applicationb1b8.css?1342212749" media="all" rel="stylesheet" type="text/css" />

<script src="../../../javascripts/prototype89c0.js?1332147363" type="text/javascript"></script>
<script src="../../../javascripts/effects89c0.js?1332147363" type="text/javascript"></script>
<script src="../../../javascripts/dragdrop89c0.js?1332147363" type="text/javascript"></script>
<script src="../../../javascripts/controls89c0.js?1332147363" type="text/javascript"></script>
<script src="../../../javascripts/application89c0.js?1332147363" type="text/javascript"></script>
<script type="text/javascript">
//<![CDATA[
Event.observe(window, 'load', function(){ new WarnLeavingUnsaved('The current page contains unsaved text that will be lost if you leave this page.'); });
//]]>
</script>



  
  

  <link href="../../../plugin_assets/redmine_wiki_extensions/stylesheets/wiki_extensions.css" media="screen" rel="stylesheet" type="text/css" />
  <script src="../../../plugin_assets/redmine_wiki_extensions/javascripts/wiki_extensions.js" type="text/javascript"></script>
  
    <script src="../../../plugin_assets/redmine_wiki_extensions/javascripts/tablesort.js" type="text/javascript"></script>
    <script type="text/javascript">
      //TableSort.arrowNone = " ";
      TableSort.arrowUp   = ' <img alt="Sort_asc" src="../../../images/sort_asc89c0.png?1332147363" />';
      TableSort.arrowDown = ' <img alt="Sort_desc" src="../../../images/sort_desc89c0.png?1332147363" />';
    </script>
  


<!-- page specific tags -->

  <link href="../../../stylesheets/scm89c0.css?1332147363" media="screen" rel="stylesheet" type="text/css" />
</head>
<body class="theme-Libavg controller-wiki action-show">
<div id="wrapper">
<div id="wrapper2">

<div id="header">
    

    

    <h1> <a href="../wiki.html"> <img src="../../../files/libavg_logo.png"/> </a> </h1>

    

    
</div>

<div class="" id="main">
    <div id="sidebar">
        
    <p><a href="WikiStart.html" class="wiki-page">Home</a><br /><a href="../../../../blog/" class="external">Blog</a><br /><a href="DownLoad.html" class="wiki-page">Download</a><br /><a href="FeatureList.html" class="wiki-page">Features</a><br /><a href="Multitouch.html" class="wiki-page">Multitouch</a><br /><a href="Showcase.html" class="wiki-page">Showcase</a></p>


	<a name="Documentation"></a>
<h2 >Documentation<a href="#Documentation" class="wiki-anchor">&para;</a></h2>


	<ul>
	<li><a href="ReleaseInstall.html" class="wiki-page">Installation Guide</a></li>
		<li><a href="ProgrammersGuide.html" class="wiki-page">Programmer's Guide</a></li>
		<li><a href="Firebirds.html" class="wiki-page">Tutorial</a></li>
		<li><a href="Reference.html" class="wiki-page">Reference</a></li>
	</ul>


	<a name="Community"></a>
<h2 >Community<a href="#Community" class="wiki-anchor">&para;</a></h2>


	<ul>
	<li><a href="BugReport.html" class="wiki-page">Reporting Bugs</a></li>
		<li><a href="Contributors.html" class="wiki-page">Contributors</a></li>
	</ul>


	<p><a href="Development.html" class="wiki-page">libavg Development</a></p>


	<p><a href="Imprint_and_Privacy_Policy.html" class="wiki-page">Imprint and Privacy Policy</a></p>
<p>
<br />
<a href="https://github.com/libavg/libavg/">Repository</a> <br />
<a href="https://github.com/libavg/libavg/issues?state=open">Issues</a> <br />
<a href="https://github.com/libavg/libavg/issues/new">New Issue</a><br />
</p>



        
    </div>

    <div id="content">
        
        





<div class="wiki wiki-page">
  <a name="Diving-In-The-Firebirds-Sample"></a>
<h1 >Diving In: The Firebirds Sample<a href="#Diving-In-The-Firebirds-Sample" class="wiki-anchor">&para;</a></h1>


	<ul class="toc right"><li><a href="#Diving-In-The-Firebirds-Sample">Diving In: The Firebirds Sample</a><ul><li><a href="#App-Structure">App Structure</a></li><li><a href="#Initialization">Initialization</a></li><li><a href="#Game-Flow">Game Flow</a></li><li><a href="#The-PlayerAircraft-Class">The PlayerAircraft Class</a></li><li><a href="#Collision-detection">Collision detection</a></li><li><a href="#Conclusion">Conclusion</a></li></ul></li></ul>


	<p>This tutorial introduces libavg programming by means of the sample <em>Firebirds</em>. This sample is a small 2D Shooter similar to "1942: Joint Strike": The player pilots a World War II fighter, shooting at enemy fighters and dodging them while the landscape scrolls vertically below the planes. Firebirds is based on XNA tutorial code developed by Alfred Bigler and published in the German magazine <a href="https://www-heise.de/ct" class="external">c't</a>. The Firebirds Python and C++ code was written by Thomas Schott. In the tutorial, we will go through the basic structure of a libavg app, including initialization, the update loop and general scene structure. We'll also cover deriving your own classes from libavg classes and introduce libavg plugins written in C++.</p>


	<p><div style="float:right"><img src="../../../attachments/download/screenshot.png" alt="" /></div></p>


	<p>The complete finished firebirds code can be found in the libavg distribution under <code>src/samples/firebirds</code> (or <a href="https://github.com/libavg/libavg/tree/master/src/samples/firebirds" class="external">online</a>), with images, videos and sounds under <code>media/</code> and the plugin source code in the <code>plugin/</code> subdirectory. The libavg code for the game is under 500 lines long - half as many as the original XNA code, even though we've added code to generate shadows of the planes on-the-fly. In addition, we detect collisions between two objects on the screen in a pixel-precise way using a simple libavg plugin. The tutorial assumes that libavg is already installed on the computer.</p>


	<p>As development environment, you can use either the PyCharm IDE or the command line and an editor of your choice.</p>


	<a name="App-Structure"></a>
<h2 >App Structure<a href="#App-Structure" class="wiki-anchor">&para;</a></h2>


	<p>Like all libavg applications, Firebirds makes use of the <a href="App.html" class="wiki-page">App</a> class. This class is instantiated in the last line of the file <a href="https://github.com/libavg/libavg/tree/master/src/samples/firebirds/firebirds.py" class="external">firebirds.py</a>:</p>


<pre><code class="python syntaxhl"><span class="CodeRay"><span class="line-numbers">1</span> app.App().run(FireBirds(), app_resolution=<span class="string"><span class="delimiter">'</span><span class="content">1280x720</span><span class="delimiter">'</span></span>)
</span></code></pre>

	<p>This line and an empty <code>FireBirds</code> class are enough to open a 1280x720 window and run the libavg main loop until the <code>Esc</code> key is pressed. The app has several command-line parameters (try starting it with <code>--help</code> or <code>--app-fullscreen=True</code>) and debug keys ('?' shows a list).</p>


	<p><div style="float:right"><img src="../../../attachments/download/gameloop.png" alt="" /></div></p>


	<p>In libavg, the main loop (for game programmers: 'Game Loop') is handled internally by the library, which calls Python functions in application code whenever certain events occur. The graph on the right shows the control flow in the application. In Firebirds, these Python functions are located in the FireBirds class.</p>


	<a name="Initialization"></a>
<h2 >Initialization<a href="#Initialization" class="wiki-anchor">&para;</a></h2>


	<p><code>onInit()</code> is called once at program start, directly after the window has been opened. In it, the scene is initialized and media such as video and sound clips as well as images are loaded. Of course, the scene can be changed and content loaded later as well.</p>


	<p>Content in libavg is stored in a tree structure, the so-called scene graph. This tree contains all media elements (called Nodes) along with the information necessary to render them - such as position, size and opacity. Among others, there are predefined Node classes for images, text and video as well as a number of vector graphics classes. Similar to html, the graph is structured using <a href="/reference/svn/areanodes.html#libavg.avg.DivNode" class="external">DivNodes</a>. <br />The application programmer can derive classes from libavg Nodes, and these can also be inserted into a scene graph. In our case, for instance, the aircraft are defined in a separate class, with two derived classes for the player's and enemy aircraft. Other elements in the scene graph include bullets, a scrolling background, and the components of the heads-up display such as the score, lives left and a gun heat gauge:</p>


	<p><img src="../../../attachments/download/scenegraph.png" alt="" /></p>


	<p>Here are the parts of the <code>onInit()</code> function that create the initial scene graph:</p>


<pre><code class="python syntaxhl"><span class="CodeRay"><span class="line-numbers"> 1</span><span class="keyword">class</span> <span class="class">FireBirds</span>(app.MainDiv):
<span class="line-numbers"> 2</span>    <span class="keyword">def</span> <span class="function">onInit</span>(<span class="predefined-constant">self</span>):
<span class="line-numbers"> 3</span>        <span class="predefined-constant">self</span>.__gameMusic = avg.SoundNode(href=<span class="string"><span class="delimiter">'</span><span class="content">Fire_Birds.mp3</span><span class="delimiter">'</span></span>, loop=<span class="predefined-constant">True</span>,
<span class="line-numbers"> 4</span>                volume=<span class="float">0.75</span>, parent=<span class="predefined-constant">self</span>)
<span class="line-numbers"> 5</span>        [...]
<span class="line-numbers"> 6</span>        <span class="predefined-constant">self</span>.__shadowDiv = avg.DivNode(parent=<span class="predefined-constant">self</span>)
<span class="line-numbers"> 7</span>        <span class="predefined-constant">self</span>.__gameDiv = avg.DivNode(size=<span class="predefined-constant">self</span>.size, parent=<span class="predefined-constant">self</span>)
<span class="line-numbers"> 8</span>        <span class="predefined-constant">self</span>.__guiDiv = avg.DivNode(parent=<span class="predefined-constant">self</span>)
<span class="line-numbers"> 9</span>        [...]
<span class="line-numbers"><strong>10</strong></span>        <span class="predefined-constant">self</span>.__player = PlayerAircraft(<span class="predefined-constant">self</span>.__shadowDiv, gunCtrl, parent=<span class="predefined-constant">self</span>.__gameDiv)
<span class="line-numbers">11</span>        [...]
<span class="line-numbers">12</span>        <span class="predefined-constant">self</span>.__gameMusic.play()
</span></code></pre>

	<a name="Game-Flow"></a>
<h2 >Game Flow<a href="#Game-Flow" class="wiki-anchor">&para;</a></h2>


	<p>Once <code>onInit()</code> has been called, the application enters the main loop. In the main loop, events are handled, the world state is updated and the screen is redrawn. Events from input devices (keyboard, mouse, touch, etc.) and timers are handled in callbacks that the application defines, such as <code>__onKeyDown()</code> and <code>__onKeyUp()</code>. In <code>__onFrame()</code>, the application calculates a new world state.</p>


	<p>The actual rendering is handled internally by libavg. By default, updates in libavg are synced to screen updates. Usually, these take place 60 times per second, so there are 16.7 milliseconds available for one iteration of the game loop. If the loop takes longer, we miss a screen update and there is a chance the game will stutter.</p>


	<p>In addition, Firebirds uses two functions that it calls when the game starts (<code>__start()</code>) and when the player has no more lives left (<code>__stop()</code>). Subscribing to the <a href="/reference/svn/player.html#libavg.avg.Player.ON_FRAME" class="external">ON_FRAME</a> event and deregistering is also done in these functions, while subscribing to keyboard events happens in <code>onInit()</code>. The <a href="/reference/svn/basenodes.html#libavg.avg.Publisher.subscribe" class="external">subscribe()</a> calls shown below cause libavg to call the named functions whenever an event occurs:</p>


<pre><code class="python syntaxhl"><span class="CodeRay"><span class="line-numbers"> 1</span><span class="keyword">class</span> <span class="class">FireBirds</span>(app.MainDiv):
<span class="line-numbers"> 2</span>    <span class="keyword">def</span> <span class="function">onInit</span>(<span class="predefined-constant">self</span>):
<span class="line-numbers"> 3</span>        [... Initialize scene graph ...]
<span class="line-numbers"> 4</span>        <span class="predefined-constant">self</span>.__start()
<span class="line-numbers"> 5</span>        player.subscribe(player.KEY_DOWN, <span class="predefined-constant">self</span>.__onKeyDown)
<span class="line-numbers"> 6</span>        player.subscribe(player.KEY_UP, <span class="predefined-constant">self</span>.__onKeyUp)
<span class="line-numbers"> 7</span>        [...]
<span class="line-numbers"> 8</span>
<span class="line-numbers"> 9</span>    <span class="keyword">def</span> <span class="function">__start</span>(<span class="predefined-constant">self</span>):
<span class="line-numbers"><strong>10</strong></span>        [...]
<span class="line-numbers">11</span>        <span class="predefined-constant">self</span>.__frameHandlerId = player.subscribe(player.ON_FRAME, <span class="predefined-constant">self</span>.__onFrame)
<span class="line-numbers">12</span>        [...]
<span class="line-numbers">13</span>
<span class="line-numbers">14</span>    <span class="keyword">def</span> <span class="function">__stop</span>(<span class="predefined-constant">self</span>):
<span class="line-numbers">15</span>        player.unsubscribe(player.ON_FRAME, <span class="predefined-constant">self</span>.__frameHandlerId)
<span class="line-numbers">16</span>        <span class="predefined-constant">self</span>.__frameHandlerId = <span class="predefined-constant">None</span>
<span class="line-numbers">17</span>        [...]
</span></code></pre>

	<p>Firebirds uses the following callbacks:</p>


<pre><code class="python syntaxhl"><span class="CodeRay"><span class="line-numbers">1</span>  <span class="keyword">class</span> <span class="class">FireBirds</span>(app.MainDiv):
<span class="line-numbers">2</span>          [...]
<span class="line-numbers">3</span>      <span class="keyword">def</span> <span class="function">__onKeyDown</span>(<span class="predefined-constant">self</span>, event):
<span class="line-numbers">4</span>          [...]
<span class="line-numbers">5</span>      <span class="keyword">def</span> <span class="function">__onKeyUp</span>(<span class="predefined-constant">self</span>, event):
<span class="line-numbers">6</span>          [...]
<span class="line-numbers">7</span>      <span class="keyword">def</span> <span class="function">__onFrame</span>(<span class="predefined-constant">self</span>):
<span class="line-numbers">8</span>          [...]
</span></code></pre>

	<p>In our application, <code>__onKeyDown()</code> and <code>__onKeyUp()</code> functions only keep track of the current key states. Actions resulting from key presses are handled during <code>__onFrame()</code>, in <code>PlayerAircraft.update()</code>. <code>__onFrame()</code> calculates a new world state: It moves some Nodes and creates and deletes others. All game logic is here, collisions are detected, points are counted, etc.. The time delta between one frame and the next is always available using <a href="/reference/svn/player.html#libavg.avg.Player.getFrameDuration" class="external">Player.getFrameDuration()</a> and used to calculate movement. All game elements are positioned in accordance with the time elapsed. The alternative - moving them a fixed distance per frame - should be avoided, since that would cause the gameplay to become faster or slower depending on the capabilities of the computer. Worse, if syncing to screen updates is off, the game might update so quickly that the player has no chance to react.</p>


	<a name="The-PlayerAircraft-Class"></a>
<h2 >The <code>PlayerAircraft</code> Class<a href="#The-PlayerAircraft-Class" class="wiki-anchor">&para;</a></h2>


	<p>Elements in a libavg scene graph are derived from the <a href="/reference/svn/basenodes.html#libavg.avg.Node" class="external">Node</a> class. libavg provides a number of derived Node classes for images, videos, etc., and the application can derive it's own classes as well.</p>


	<p>As an example, we'll go through the <code>PlayerAircraft</code> class. It's derived from <code>_Aircraft</code>, which is in turn derived from <a href="/reference/svn/areanodes.html#libavg.avg.DivNode" class="external">DivNode</a>, so it can be inserted into the scene graph and will be rendered each frame along with the rest of the scene. By themselves, <code>DivNodes</code> are invisible, but they can have visible children. Since an invisible aircraft makes for bad gameplay, the <code>_Aircraft</code> class creates several nodes for the visuals and adds them as child nodes into the tree. The most important one is a <a href="/reference/svn/areanodes.html#libavg.avg.VideoNode" class="external">VideoNode</a> that shows the actual airplane in motion. Since libavg is able to start and stop videos as well as loop them practically instantaneously, this is the easiest way to create moving images of game elements. The videos have an alpha (transparency) channel so they blend seamlessly into the background. If the plane explodes, a second video containing the explosion is played. Shadows are handled here as well, but placed in a separate layer in the scene graph so they're behind all aircraft. Shadows are <a href="/reference/svn/areanodes.html#libavg.avg.ImageNode" class="external">ImageNodes</a> with an added <a href="/reference/svn/fx.html#libavg.avg.BlurFXNode" class="external">blur effect</a>.</p>


	<a name="Collision-detection"></a>
<h2 >Collision detection<a href="#Collision-detection" class="wiki-anchor">&para;</a></h2>


	<p>Detecting collisions between aircraft in a pixel-precise way would be too slow if it were done in Python. For this reason, we implemented a small libavg <a href="Plugins.html" class="wiki-page">plugin</a> - a C++ library that extends libavg. The <code>collisiondetector</code> plugin defines a new class that is exposed to python, the <code>CollisionDetector</code>. It is initialized with two bitmaps, and when <code>detect()</code> is called, it compares the bitmaps pixel-by pixel to see if any non-transparent pixels are at the same position. If so, we have a collision.</p>


	<a name="Conclusion"></a>
<h2 >Conclusion<a href="#Conclusion" class="wiki-anchor">&para;</a></h2>


	<p>This tutorial has covered many of the things necessary to build general libavg apps: The lifecycle, main loop and scene graph are the same whether you're building a scrolling game or a serious application. The same goes for deriving Node classes, reacting to input events and handling application state changes. Of course, we could only introduce a few of the libavg features. We've missed a lot of interesting things, such as gesture support (as well as <a href="MouseAndTouchInput.html" class="wiki-page">touch input in general</a>), <a href="OffscreenRendering.html" class="wiki-page">offscreen rendering</a>, <a href="RenderingAttributes.html" class="wiki-page">masking</a> and other <a href="FXNodes.html" class="wiki-page">effects</a>.</p>


	<p>So, there should be nothing preventing you from writing your own libavg apps at this point and updating your knowledge as you go.</p>


	<p></p>
</div>


        
        <div style="clear:both;"></div>
    </div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>


</div>
</div>
<script type="text/javascript">
//<![CDATA[
wiki_extension_create_table_header();
//]]>
</script>
</body>

<!-- Mirrored from www.libavg.de/site/projects/libavg/wiki/Firebirds by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 11 Jan 2025 17:19:59 GMT -->
</html>
