<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">

<!-- Mirrored from www.libavg.de/site/projects/libavg/wiki/RaspberryPISourceInstall?version=10 by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 11 Jan 2025 18:22:59 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<title>RaspberryPISourceInstall - libavg</title>
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<meta name="csrf-param" content="authenticity_token"/>
<meta name="csrf-token" content="QVLF6cREvlOFkeaPHt4RhwQPDtrjsY3s5ITeOtTQ66Y="/>
<link rel='shortcut icon' href='../../../favicon89c0.ico?1332147363' />
<link href="../../../themes/libavg/stylesheets/applicationb1b8.css?1342212749" media="all" rel="stylesheet" type="text/css" />

<script src="../../../javascripts/prototype89c0.js?1332147363" type="text/javascript"></script>
<script src="../../../javascripts/effects89c0.js?1332147363" type="text/javascript"></script>
<script src="../../../javascripts/dragdrop89c0.js?1332147363" type="text/javascript"></script>
<script src="../../../javascripts/controls89c0.js?1332147363" type="text/javascript"></script>
<script src="../../../javascripts/application89c0.js?1332147363" type="text/javascript"></script>
<script type="text/javascript">
//<![CDATA[
Event.observe(window, 'load', function(){ new WarnLeavingUnsaved('The current page contains unsaved text that will be lost if you leave this page.'); });
//]]>
</script>



  
  

  <link href="../../../plugin_assets/redmine_wiki_extensions/stylesheets/wiki_extensions.css" media="screen" rel="stylesheet" type="text/css" />
  <script src="../../../plugin_assets/redmine_wiki_extensions/javascripts/wiki_extensions.js" type="text/javascript"></script>
  
    <script src="../../../plugin_assets/redmine_wiki_extensions/javascripts/tablesort.js" type="text/javascript"></script>
    <script type="text/javascript">
      //TableSort.arrowNone = " ";
      TableSort.arrowUp   = ' <img alt="Sort_asc" src="../../../images/sort_asc89c0.png?1332147363" />';
      TableSort.arrowDown = ' <img alt="Sort_desc" src="../../../images/sort_desc89c0.png?1332147363" />';
    </script>
  


<!-- page specific tags -->

  <link href="../../../stylesheets/scm89c0.css?1332147363" media="screen" rel="stylesheet" type="text/css" />
</head>
<body class="theme-Libavg controller-wiki action-show">
<div id="wrapper">
<div id="wrapper2">

<div id="header">
    

    

    <h1> <a href="../wiki.html"> <img src="../../../files/libavg_logo.png"/> </a> </h1>

    

    
</div>

<div class="" id="main">
    <div id="sidebar">
        
    <p><a href="WikiStart.html" class="wiki-page">Home</a><br /><a href="../../../../blog/" class="external">Blog</a><br /><a href="DownLoad.html" class="wiki-page">Download</a><br /><a href="FeatureList.html" class="wiki-page">Features</a><br /><a href="Multitouch.html" class="wiki-page">Multitouch</a><br /><a href="Showcase.html" class="wiki-page">Showcase</a></p>


	<a name="Documentation"></a>
<h2 >Documentation<a href="#Documentation" class="wiki-anchor">&para;</a></h2>


	<ul>
	<li><a href="ReleaseInstall.html" class="wiki-page">Installation Guide</a></li>
		<li><a href="ProgrammersGuide.html" class="wiki-page">Programmer's Guide</a></li>
		<li><a href="Firebirds.html" class="wiki-page">Tutorial</a></li>
		<li><a href="Reference.html" class="wiki-page">Reference</a></li>
	</ul>


	<a name="Community"></a>
<h2 >Community<a href="#Community" class="wiki-anchor">&para;</a></h2>


	<ul>
	<li><a href="BugReport.html" class="wiki-page">Reporting Bugs</a></li>
		<li><a href="Contributors.html" class="wiki-page">Contributors</a></li>
	</ul>


	<p><a href="Development.html" class="wiki-page">libavg Development</a></p>


	<p><a href="Imprint_and_Privacy_Policy.html" class="wiki-page">Imprint and Privacy Policy</a></p>
<p>
<br />
<a href="https://github.com/libavg/libavg/">Repository</a> <br />
<a href="https://github.com/libavg/libavg/issues?state=open">Issues</a> <br />
<a href="https://github.com/libavg/libavg/issues/new">New Issue</a><br />
</p>



        
    </div>

    <div id="content">
        
        




    <p>
    <a href="RaspberryPISourceInstall29f9.html?version=9">« Previous</a> - 
    Version 10/27
    (<a href="RaspberryPISourceInstall/diff/10.html">diff</a>) - 
    <a href="RaspberryPISourceInstall1a8e.html?version=11">Next »</a> - 
    <a href="RaspberryPISourceInstall.html">Current version</a>
    <br />
    <em><a href="../../../users/4.html">coder</a>, 25/04/2015 21:47 </em><br />
    
    </p>
    <hr />


<div class="wiki wiki-page">
  <a name="RaspberryPiSourceInstall"></a>
<h1 >RaspberryPiSourceInstall<a href="#RaspberryPiSourceInstall" class="wiki-anchor">&para;</a></h1>


	<p>This page explains how to install the libavg developer version from github on a Raspberry Pi by cross-compiling. The process involves compiling libavg on a separate Linux machine. The benefit of this is that compiling on the Pi 2 takes around an hour, while cross-compiling takes a few minutes (The original Pi would finish in 4-6 hours or fail with an out of memory condition). The downside is that it's a bit harder to set up.</p>


	<p>Alternatively, you can compile directly on the Pi by following the <a href="UbuntuSourceInstall.html" class="wiki-page">UbuntuSourceInstall</a> directions and pass <code>--enable-rpi --enable-egl</code> to configure.</p>


	<a name="Install-dependencies-on-the-Pi"></a>
<h2 >Install dependencies on the Pi<a href="#Install-dependencies-on-the-Pi" class="wiki-anchor">&para;</a></h2>


	<p><strong><em>On the Pi</em></strong>, install the needed packages:</p>


<pre>
<code>$ sudo apt-get install git automake autoconf libtool libxml2-dev \
libpango1.0-dev librsvg2-dev libgdk-pixbuf2.0-dev libavcodec-dev libavformat-dev \
libswscale-dev libavresample-dev python-dev libboost-python-dev libboost-thread-dev g++ libSDL-dev \
libxxf86vm-dev libdc1394-22-dev linux-libc-dev
</code></pre>

	<a name="Set-up-the-Cross-compile-Toolchain"></a>
<h2 >Set up the Cross-compile Toolchain<a href="#Set-up-the-Cross-compile-Toolchain" class="wiki-anchor">&para;</a></h2>


	<p>This is the directory structure on the Linux machine:</p>


<pre>
rpi
    libavg        - the libavg source tree
    root          - copy of the PI filesystem
    rpi-tools     - the toolchain (compiler, linker, etc.) used to cross-compile
    staging       - the compiled version of libavg that will be copied to the PI
</pre>

	<p><strong><em>On the Linux machine</em></strong>, download the crosscompile tools to rpi-tools:</p>


<pre>
<code>$ cd rpi
$ git clone git://github.com/raspberrypi/tools.git
</code></pre>

	<p>Copy /usr, /lib, and /opt/vc directory trees from the Pi (replace $PI with the IP address of the Pi):</p>


<pre>
<code>$ mkdir root
$ cd root
$ rsync -rl --delete-after --safe-links pi@$PI:/{lib,usr} .
$ rsync -rl --delete-after --safe-links pi@192.168.2.PI:/opt/vc opt
</code></pre>

	<p>Then, fix some system libraries so they don't contain references to absolute directories. Open the files in a text editor and change them. They are:</p>


	<p><em>root/usr/lib/arm-linux-gnueabihf/libpthread.so</em>:</p>


<pre>
<code>OUTPUT_FORMAT(elf32-littlearm)
GROUP ( libpthread.so.0 libpthread_nonshared.a )
</code></pre>

	<p><em>root/usr/lib/arm-linux-gnueabihf/libc.so</em>:</p>


<pre>
<code>OUTPUT_FORMAT(elf32-littlearm)
GROUP ( libc.so.6 libc_nonshared.a  AS_NEEDED ( ld-linux-armhf.so.3 ) )
</code></pre>

	<p>Fix some symlinks:</p>


<pre>
<code>$ cd root/usr/lib/arm-linux-gnueabihf/
$ ln -s ../../../lib/arm-linux-gnueabihf/libm.so.6 libm.so
$ ln -s ../../../lib/arm-linux-gnueabihf/libdl.so.2 libdl.so
</code></pre>

	<p>Put the toolchain into the path ($RPI is the absolute path to your rpi directory):</p>


<pre>
<code>$ export PATH=$PATH:$RPI/rpi-tools/arm-bcm2708/gcc-linaro-arm-linux-gnueabihf-raspbian-x64/bin
</code></pre>

	<a name="Build-libavg"></a>
<h2 >Build libavg<a href="#Build-libavg" class="wiki-anchor">&para;</a></h2>


	<p>Tell configure which architecture to build for. For Raspbian on the Pi 2:</p>


<pre>
<code>$ export ARCHFLAGS="-mcpu=cortex-a7 -mfpu=neon-vfpv4" 
</code></pre>

	<p>and for the older Pi:</p>


<pre>
<code>$ export ARCHFLAGS="-march=armv6 -mfloat-abi=hard -mfpu=vfp" 
</code></pre>

	<p>for other distros, run <code>gcc -mcpu=native -march=native -Q --help=target</code> on the Pi<br />to find out what to set ARCHFLAGS to.</p>


	<p>Once you've set the architecture, build:</p>


<pre>
<code>$ ./bootstrap
$ ./rpi-configure
$ DESTDIR=$RPI/staging make -j6
$ DESTDIR=$RPI/staging make install
</code></pre>

	<a name="Install-on-the-Pi"></a>
<h2 >Install on the Pi<a href="#Install-on-the-Pi" class="wiki-anchor">&para;</a></h2>


	<p>Copy the compiled libavg to the Pi:</p>


<pre>
<code>$ cd staging
$ rsync -au usr pi@$IP:/home/pi/Desktop
</code></pre>

	<p><strong><em>On the Pi</em></strong>, copy libavg from the desktop to its final destination:</p>


<pre>
<code>$ sudo cp -R ~/Desktop/usr/* /usr
</code></pre>

	<a name="Run-the-tests"></a>
<h2 >Run the tests<a href="#Run-the-tests" class="wiki-anchor">&para;</a></h2>


<pre>
<code>$ cd /usr/local/share/python-libavg/test/
$ python Test.py
</code></pre>

	<p>That's it! libavg should now be running on your Pi.</p>


	<p></p>
</div>














        
        <div style="clear:both;"></div>
    </div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>


</div>
</div>
<script type="text/javascript">
//<![CDATA[
wiki_extension_create_table_header();
//]]>
</script>
</body>

<!-- Mirrored from www.libavg.de/site/projects/libavg/wiki/RaspberryPISourceInstall?version=10 by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 11 Jan 2025 18:22:59 GMT -->
</html>
